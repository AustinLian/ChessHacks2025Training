# ChessHacks Competition Compliance

This document explicitly maps competition rules to our implementation.

## Competition Rules Checklist

### ✓ Legal Chess Rules

All standard chess rules are implemented in `engine/src/movegen.cpp`:

- [x] **Piece Movement**: Pawn, Knight, Bishop, Rook, Queen, King
- [x] **Castling**: Kingside and queenside for both colors
  - Cannot castle through check
  - Cannot castle if king or rook has moved
  - Cannot castle if in check
- [x] **En Passant**: Pawn captures en passant
- [x] **Promotion**: Pawns promote on 8th/1st rank to Q, R, B, or N
- [x] **Check**: King cannot move into check
- [x] **Checkmate**: No legal moves while in check
- [x] **Stalemate**: No legal moves while not in check
- [x] **Draw Conditions**:
  - Threefold repetition (tracked in `repetition.cpp`)
  - 50-move rule (halfmove clock)
  - Insufficient material

Validation: `engine/tests/legality_tests.cpp` and `engine/tests/perft_tests.cpp`

### ✓ Time Controls

Implemented in `engine/src/time_manager.cpp`:

- [x] **Blitz** (Knight's Edge): 3 min + 2 sec increment
  - Config: `config/tracks/blitz.yaml`
  - Aggressive time allocation
  - Optimized for quick decisions

- [x] **Rapid**: 10 min + 5 sec increment
  - Config: `config/tracks/rapid.yaml`
  - More conservative time management
  - Deeper search allowed

Time management features:
- Allocate time based on remaining time and expected moves
- Move overhead buffer (to account for communication latency)
- Adaptive allocation based on position complexity (future)

### ✓ External Resources Policy

**Allowed:**
- [x] Pre-trained neural networks (our own)
- [x] Opening books (generated by us)
- [x] Endgame tablebases (if we implement)

**NOT Allowed (and we don't use):**
- [ ] ✗ External chess engines (Stockfish, Leela, etc.)
- [ ] ✗ Cloud compute during games
- [ ] ✗ Human intervention during games

**Our Approach:**
- Self-contained C++ engine
- Neural network trained by us
- No external engine calls
- All evaluation happens locally

### ✓ UCI Protocol

Implemented in `engine/src/uci.cpp`:

- [x] **Identification**: Engine name and author
- [x] **Position Setup**: `position startpos`, `position fen`
- [x] **Move Input**: `position moves e2e4 e7e5 ...`
- [x] **Search Commands**: 
  - `go wtime X btime Y winc A binc B`
  - `go movetime X`
  - `go depth X`
- [x] **Best Move Output**: `bestmove e2e4`
- [x] **Stop Command**: `stop` to halt search

Compliance notes:
- Engine responds to all required UCI commands
- Outputs moves in UCI format (e.g., `e2e4`, `e7e8q` for promotion)
- Respects time limits strictly

### ✓ Fair Play

- [x] **No Cheating**: No calls to external engines
- [x] **Deterministic**: Same position + time = same result (with seed)
- [x] **Self-Contained**: Runs on provided hardware only

Code verification:
- Search `engine/` directory: no subprocess calls to other engines
- Network code: only loads local weight files
- No internet access required during games

### ✓ Submission Requirements

Structure matches required format:

```
ChessHacks2025/
├─ engine/                  # C++ source code
│   ├─ Makefile             # Build configuration
│   ├─ src/                 # Implementation
│   └─ include/             # Headers
├─ weights/                 # Pre-trained models
│   └─ current/             # Production weights
├─ config/                  # Configuration files
│   ├─ engine.yaml
│   └─ tracks/              # Per-track configs
└─ README.md                # Build and run instructions
```

Build process:
```bash
cd engine
make
./build/chesshacks_engine
```

## Track-Specific Compliance

### Blitz Track (Knight's Edge)

Configuration: `config/tracks/blitz.yaml`

Optimizations for blitz:
- Shallower search depth limit (32 vs 64)
- Smaller transposition table (128 MB vs 512 MB)
- Fewer nodes per self-play move (400 vs 1600)
- More aggressive time allocation (10% buffer vs 5%)

Verified against rules:
- Respects 3+2 time control
- Handles increment correctly
- Doesn't exceed time limit

### Rapid Track

Configuration: `config/tracks/rapid.yaml`

Optimizations for rapid:
- Deeper search allowed (depth 64)
- Larger transposition table (512 MB)
- More nodes per move for better quality
- Conservative time allocation

Verified against rules:
- Respects 10+5 time control
- Utilizes extra time for better moves
- Still finishes games without timeout

## Testing Compliance

### Perft Tests
`engine/tests/perft_tests.cpp` verifies move generation correctness:
- Starting position: depth 5 = 4,865,609 nodes (known result)
- Kiwipete position: complex position with all special moves
- Edge cases: promotions, en passant, castling

### Legality Tests
`engine/tests/legality_tests.cpp` verifies special rules:
- Castling through check (should be illegal)
- En passant (should be legal when conditions met)
- Promotion (all 4 promotion types)
- No moving into check

### Integration Tests
Run full games to verify:
- Time management (doesn't timeout)
- Legal move generation (no illegal moves)
- Game termination (recognizes checkmate/stalemate/draw)

## Compliance Verification Commands

```bash
# Verify no external engine calls
grep -r "popen\|system\|exec" engine/src/
# (should return nothing or only safe calls)

# Verify UCI compliance
echo "uci" | ./engine/build/chesshacks_engine
# (should output engine info and "uciok")

# Verify time management
echo -e "position startpos\ngo movetime 1000" | ./engine/build/chesshacks_engine
# (should respond within ~1 second)

# Run legal move tests
./engine/build/legality_tests

# Run perft tests
./engine/build/perft_tests
```

## Documentation of Compliance

All compliance-critical code is documented:

- `engine/src/movegen.cpp`: Legal move generation
- `engine/src/time_manager.cpp`: Time control adherence
- `engine/src/uci.cpp`: Protocol compliance
- `engine/tests/`: Verification of correctness

Judges can verify:
1. Build engine from source
2. Run test suite
3. Inspect code for external calls
4. Test UCI communication
5. Verify time management in practice games

## Declaration

We certify that:
- All code is our own or properly attributed
- No external engines are used during gameplay
- Neural network is trained by us using allowed data sources
- Engine operates within competition rules and time limits
- Implementation is fair and complies with spirit of competition

Any questions about compliance can be answered by inspecting:
- Source code (fully open)
- Test suite (demonstrates correctness)
- Training pipeline (shows data sources)
- Documentation (explains design decisions)
